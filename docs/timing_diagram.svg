<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="1200" height="640" viewBox="0 0 1200 640" xmlns="http://www.w3.org/2000/svg" font-family="Helvetica, Arial, sans-serif">

  <defs>
    <style>
      .title { font-size:20px; font-weight:700; }
      .axis  { stroke:#444; stroke-width:1; }
      .sig   { stroke:#111; stroke-width:2; fill:none; }
      .hi    { fill:#1a73e8; }           /* blue high fill */
      .lo    { fill:#e8eaed; }           /* light low fill */
      .note  { font-size:12px; fill:#111; }
      .lbl   { font-size:14px; fill:#111; font-weight:600; }
      .tag   { font-size:12px; fill:#111; }
      .shade { fill:#fde293; opacity:0.6; }
      .busbox{ fill:#fff; stroke:#111; stroke-width:1; }
      .arrow { marker-end:url(#arrowhead); }
    </style>

    <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#111"/>
    </marker>
  </defs>

  <!-- ===================== Panel 1: Ready/Valid with Backpressure ===================== -->
  <g transform="translate(40,30)">
    <text class="title">Streaming handshakes with lossless backpressure</text>
    <text class="note" x="0" y="26">(Abstracted from: rx→parser (payload_valid/ready), parser→logic (p2l_*), logic→UART (l2t_* &amp; uart_ready_masked). Data moves only when valid ∧ ready.)</text>

    <!-- Time axis -->
    <g transform="translate(0,50)">
      <line class="axis" x1="0" y1="0" x2="1080" y2="0"/>
      <!-- ticks every 80 px (~1 cycle abstraction) -->
      <g class="note" fill="#666">
        <!-- 14 ticks -->
        <g>
          <line class="axis" x1="0" y1="-4" x2="0" y2="4"/><text x="0" y="-8" text-anchor="middle">t0</text>
          <line class="axis" x1="80" y1="-4" x2="80" y2="4"/><text x="80" y="-8" text-anchor="middle">t1</text>
          <line class="axis" x1="160" y1="-4" x2="160" y2="4"/><text x="160" y="-8" text-anchor="middle">t2</text>
          <line class="axis" x1="240" y1="-4" x2="240" y2="4"/><text x="240" y="-8" text-anchor="middle">t3</text>
          <line class="axis" x1="320" y1="-4" x2="320" y2="4"/><text x="320" y="-8" text-anchor="middle">t4</text>
          <line class="axis" x1="400" y1="-4" x2="400" y2="4"/><text x="400" y="-8" text-anchor="middle">t5</text>
          <line class="axis" x1="480" y1="-4" x2="480" y2="4"/><text x="480" y="-8" text-anchor="middle">t6</text>
          <line class="axis" x1="560" y1="-4" x2="560" y2="4"/><text x="560" y="-8" text-anchor="middle">t7</text>
          <line class="axis" x1="640" y1="-4" x2="640" y2="4"/><text x="640" y="-8" text-anchor="middle">t8</text>
          <line class="axis" x1="720" y1="-4" x2="720" y2="4"/><text x="720" y="-8" text-anchor="middle">t9</text>
          <line class="axis" x1="800" y1="-4" x2="800" y2="4"/><text x="800" y="-8" text-anchor="middle">t10</text>
          <line class="axis" x1="880" y1="-4" x2="880" y2="4"/><text x="880" y="-8" text-anchor="middle">t11</text>
          <line class="axis" x1="960" y1="-4" x2="960" y2="4"/><text x="960" y="-8" text-anchor="middle">t12</text>
          <line class="axis" x1="1040" y1="-4" x2="1040" y2="4"/><text x="1040" y="-8" text-anchor="middle">t13</text>
        </g>
      </g>

      <!-- Signal rows -->
      <g transform="translate(0,30)">
        <!-- Labels -->
        <g class="lbl" fill="#111">
          <text x="-10" y="0" text-anchor="end">payload_valid</text>
          <text x="-10" y="40" text-anchor="end">payload_ready</text>
          <text x="-10" y="80" text-anchor="end">payload_byte[7:0]</text>
          <text x="-10" y="140" text-anchor="end">p2l_out_valid</text>
          <text x="-10" y="180" text-anchor="end">p2l_out_ready</text>
          <text x="-10" y="220" text-anchor="end">l2t_out_valid</text>
          <text x="-10" y="260" text-anchor="end">uart_ready_masked</text>
          <text x="-10" y="300" text-anchor="end">tx_word_valid</text>
        </g>

        <!-- payload_valid -->
        <g transform="translate(0,-12)">
          <!-- high pulses: t2..t6 and t8..t10 -->
          <rect class="hi" x="160" y="0" width="240" height="24"/>
          <rect class="hi" x="640" y="0" width="160" height="24"/>
          <rect class="lo" x="0" y="0" width="160" height="24"/>
          <rect class="lo" x="400" y="0" width="240" height="24"/>
          <rect class="lo" x="800" y="0" width="280" height="24"/>
        </g>

        <!-- payload_ready (always ready except an early bubble to show concept) -->
        <g transform="translate(0,28)">
          <rect class="hi" x="0" y="0" width="1080" height="24"/>
          <rect class="lo" x="80" y="0" width="80" height="24"/>
          <text class="tag" x="90" y="18">bubble</text>
        </g>

        <!-- payload_byte bus boxes aligned with valid window -->
        <g transform="translate(0,68)">
          <rect class="busbox" x="160" y="-12" width="80"  height="24"/><text class="tag" x="200" y="5" text-anchor="middle">0x50</text>
          <rect class="busbox" x="240" y="-12" width="80"  height="24"/><text class="tag" x="280" y="5" text-anchor="middle">0x00</text>
          <rect class="busbox" x="320" y="-12" width="80"  height="24"/><text class="tag" x="360" y="5" text-anchor="middle">…</text>

          <rect class="busbox" x="640" y="-12" width="80"  height="24"/><text class="tag" x="680" y="5" text-anchor="middle">0x1F</text>
          <rect class="busbox" x="720" y="-12" width="80"  height="24"/><text class="tag" x="760" y="5" text-anchor="middle">0xA0</text>
        </g>

        <!-- p2l_out_valid (1-cycle pulse after header parse) -->
        <g transform="translate(0,128)">
          <rect class="hi" x="440" y="0" width="80" height="24"/>
          <rect class="hi" x="840" y="0" width="80" height="24"/>
          <rect class="lo" x="0"   y="0" width="1080" height="24" opacity="0.4"/>
          <text class="tag" x="480" y="18" text-anchor="middle">PARSED</text>
          <text class="tag" x="880" y="18" text-anchor="middle">PARSED</text>
        </g>

        <!-- p2l_out_ready (logic always ready here) -->
        <g transform="translate(0,168)">
          <rect class="hi" x="0" y="0" width="1080" height="24"/>
        </g>

        <!-- l2t_out_valid (decision appears a few cycles later) -->
        <g transform="translate(0,208)">
          <rect class="hi" x="520" y="0" width="80" height="24"/>
          <rect class="hi" x="920" y="0" width="80" height="24"/>
          <rect class="lo" x="0"   y="0" width="1080" height="24" opacity="0.4"/>
          <text class="tag" x="560" y="18" text-anchor="middle">DECISION</text>
          <text class="tag" x="960" y="18" text-anchor="middle">DECISION</text>
        </g>

        <!-- uart_ready_masked (stall between t9..t11) -->
        <g transform="translate(0,248)">
          <rect class="hi" x="0"   y="0" width="720" height="24"/>
          <rect class="lo" x="720" y="0" width="160" height="24"/>
          <rect class="hi" x="880" y="0" width="200" height="24"/>
          <rect class="shade" x="720" y="-6" width="160" height="36"/>
          <text class="tag" x="800" y="-10" text-anchor="middle">forced stall (sink_allow=0)</text>
        </g>

        <!-- tx_word_valid (fires only when decision ∧ uart_ready_masked) -->
        <g transform="translate(0,288)">
          <rect class="hi" x="520" y="0" width="80" height="24"/>
          <!-- the second decision is held until stall clears -->
          <rect class="hi" x="920" y="0" width="80" height="24"/>
          <rect class="lo" x="0"   y="0" width="1080" height="24" opacity="0.4"/>
        </g>

        <!-- Latency arrows -->
        <g class="note" fill="#111">
          <line x1="160" y1="-12" x2="520" y2="300" stroke="#111" stroke-dasharray="4,4" class="arrow"/>
          <text x="165" y="-18">ingress</text>
          <text x="530" y="315">decision accept</text>
        </g>
      </g>
    </g>
  </g>

  <!-- ===================== Panel 2: UART 8N1 Byte ===================== -->
  <g transform="translate(40,380)">
    <text class="title">UART 8N1 transmission (one byte, LSB-first)</text>
    <text class="note" x="0" y="26">Matches your uart_tx: start=0, 8 data bits LSB→MSB, stop=1. Bit period = CLK_FREQ_HZ / BAUD_RATE.</text>

    <!-- Axis -->
    <g transform="translate(0,50)">
      <line class="axis" x1="0" y1="0" x2="1080" y2="0"/>
      <g class="note" fill="#666">
        <text x="0" y="-8" text-anchor="middle">t0</text>
        <text x="120" y="-8" text-anchor="middle">t1</text>
        <text x="240" y="-8" text-anchor="middle">t2</text>
        <text x="360" y="-8" text-anchor="middle">t3</text>
        <text x="480" y="-8" text-anchor="middle">t4</text>
        <text x="600" y="-8" text-anchor="middle">t5</text>
        <text x="720" y="-8" text-anchor="middle">t6</text>
        <text x="840" y="-8" text-anchor="middle">t7</text>
        <text x="960" y="-8" text-anchor="middle">t8</text>
        <text x="1080" y="-8" text-anchor="middle">t9</text>
      </g>

      <!-- Label -->
      <text class="lbl" x="-10" y="40" text-anchor="end">tx_line</text>

      <!-- Idle high -->
      <rect class="hi" x="0" y="30" width="1080" height="24" opacity="0.15"/>

      <!-- Start bit (low) @ t1 -->
      <rect class="lo" x="120" y="30" width="120" height="24"/>

      <!-- 8 data bits (example byte 0xA5 = 1010_0101, LSB-first -> 1,0,1,0,0,1,0,1) -->
      <rect class="hi" x="240" y="30" width="120" height="24"/>  <!-- b0 = 1 -->
      <rect class="lo" x="360" y="30" width="120" height="24"/>  <!-- b1 = 0 -->
      <rect class="hi" x="480" y="30" width="120" height="24"/>  <!-- b2 = 1 -->
      <rect class="lo" x="600" y="30" width="120" height="24"/>  <!-- b3 = 0 -->
      <rect class="lo" x="720" y="30" width="120" height="24"/>  <!-- b4 = 0 -->
      <rect class="hi" x="840" y="30" width="120" height="24"/>  <!-- b5 = 1 -->
      <rect class="lo" x="960" y="30" width="120" height="24"/>  <!-- b6 = 0 -->
      <rect class="hi" x="1080" y="30" width="120" height="24"/> <!-- b7 = 1 -->

      <!-- Stop bit (high) @ next slot -->
      <rect class="hi" x="1200" y="30" width="120" height="24"/>

      <!-- Bit labels -->
      <g class="tag" fill="#111">
        <text x="180" y="24" text-anchor="middle">START</text>
        <text x="300" y="24" text-anchor="middle">b0=1</text>
        <text x="420" y="24" text-anchor="middle">b1=0</text>
        <text x="540" y="24" text-anchor="middle">b2=1</text>
        <text x="660" y="24" text-anchor="middle">b3=0</text>
        <text x="780" y="24" text-anchor="middle">b4=0</text>
        <text x="900" y="24" text-anchor="middle">b5=1</text>
        <text x="1020" y="24" text-anchor="middle">b6=0</text>
        <text x="1140" y="24" text-anchor="middle">b7=1</text>
        <text x="1260" y="24" text-anchor="middle">STOP</text>
      </g>

      <!-- Guard notes -->
      <text class="note" x="0" y="90">• Bit width = BAUD_TICKS cycles. • Line idles high. • Word is latched at accept (ready=1 in IDLE).</text>
    </g>
  </g>

</svg>
